<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#6366f1">
    <link rel="manifest" href="manifest.json">
    <title>Mein Gewohnheitstracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50">
    <div id="app"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons as SVG components
        const Calendar = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const CheckCircle = () => (
            <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10" opacity="0.2"></circle>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );

        const Circle = () => (
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
            </svg>
        );

        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Briefcase = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
        );

        const Users = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const Clock = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const TrendingUp = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        function HabitTracker() {
            const loadData = () => {
                try {
                    const savedHabits = localStorage.getItem('habits');
                    const savedWorkDays = localStorage.getItem('workDays');
                    return {
                        savedHabits: savedHabits ? JSON.parse(savedHabits) : null,
                        savedWorkDays: savedWorkDays ? JSON.parse(savedWorkDays) : {}
                    };
                } catch (e) {
                    return { savedHabits: null, savedWorkDays: {} };
                }
            };

            const { savedHabits, savedWorkDays } = loadData();

            const [habits, setHabits] = useState(savedHabits || [
                { id: 1, name: 'Abend-Yoga (20-30 Min)', category: 'Yoga', color: 'purple', completed: {} },
                { id: 2, name: 'Sport/Training (60 Min) - Ziel: 3-4x/Woche', category: 'Sport', color: 'blue', completed: {} },
                { id: 3, name: 'Wochenplanung (Sonntag)', category: 'Zeitmanagement', color: 'green', completed: {} },
                { id: 4, name: 'Meal Prep / Vorbereitung', category: 'Zeitmanagement', color: 'green', completed: {} },
                { id: 5, name: 'Haushalt / Einkauf', category: 'Alltag', color: 'orange', completed: {} },
                { id: 6, name: 'Erholungszeit / Freizeit', category: 'Alltag', color: 'orange', completed: {} },
            ]);

            const [workDays, setWorkDays] = useState(savedWorkDays);
            const [newHabit, setNewHabit] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('Sport');
            const [currentWeek, setCurrentWeek] = useState(0);

            const categories = {
                'Sport': 'blue',
                'Yoga': 'purple',
                'Zeitmanagement': 'green',
                'Alltag': 'orange'
            };

            useEffect(() => {
                localStorage.setItem('habits', JSON.stringify(habits));
            }, [habits]);

            useEffect(() => {
                localStorage.setItem('workDays', JSON.stringify(workDays));
            }, [workDays]);

            const getWeekDates = (weekOffset) => {
                const today = new Date();
                const startOfWeek = new Date(today);
                startOfWeek.setDate(today.getDate() - today.getDay() + 1 + (weekOffset * 7));
                
                return Array.from({ length: 7 }, (_, i) => {
                    const date = new Date(startOfWeek);
                    date.setDate(startOfWeek.getDate() + i);
                    return date;
                });
            };

            const weekDates = getWeekDates(currentWeek);
            const weekDays = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];

            const formatDate = (date) => {
                return `${date.getDate()}.${date.getMonth() + 1}.`;
            };

            const getDateKey = (date) => {
                return `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
            };

            const toggleHabit = (habitId, date) => {
                const dateKey = getDateKey(date);
                setHabits(habits.map(habit => {
                    if (habit.id === habitId) {
                        const newCompleted = { ...habit.completed };
                        newCompleted[dateKey] = !newCompleted[dateKey];
                        return { ...habit, completed: newCompleted };
                    }
                    return habit;
                }));
            };

            const toggleWorkDay = (date) => {
                const dateKey = getDateKey(date);
                setWorkDays(prev => ({
                    ...prev,
                    [dateKey]: !prev[dateKey]
                }));
            };

            const isWorkDay = (date) => {
                return workDays[getDateKey(date)] || false;
            };

            const isTrainingDay = (date) => {
                const day = date.getDay();
                return day === 2 || day === 3 || day === 5;
            };

            const addHabit = () => {
                if (newHabit.trim()) {
                    setHabits([...habits, {
                        id: Date.now(),
                        name: newHabit,
                        category: selectedCategory,
                        color: categories[selectedCategory],
                        completed: {}
                    }]);
                    setNewHabit('');
                }
            };

            const deleteHabit = (id) => {
                setHabits(habits.filter(h => h.id !== id));
            };

            const getWeekStats = () => {
                const totalPossible = habits.length * 7;
                if (totalPossible === 0) return 0;
                const completed = habits.reduce((sum, habit) => {
                    return sum + weekDates.filter(date => habit.completed[getDateKey(date)]).length;
                }, 0);
                return Math.round((completed / totalPossible) * 100);
            };

            const getSportStats = () => {
                const sportHabit = habits.find(h => h.category === 'Sport');
                if (!sportHabit) return 0;
                return weekDates.filter(date => sportHabit.completed[getDateKey(date)]).length;
            };

            const isToday = (date) => {
                const today = new Date();
                return date.getDate() === today.getDate() &&
                    date.getMonth() === today.getMonth() &&
                    date.getFullYear() === today.getFullYear();
            };

            return (
                <div className="min-h-screen p-4 md:p-6">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-2xl shadow-lg p-4 md:p-6 mb-4">
                            <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-4">
                                <div className="flex-1">
                                    <h1 className="text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-2">
                                        <Calendar />
                                        Mein Gewohnheitstracker
                                    </h1>
                                    <p className="text-sm text-gray-600 mt-1">Schichtarbeit + Jugendtraining</p>
                                </div>
                                <div className="flex gap-3 w-full md:w-auto">
                                    <div className="flex-1 text-center bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-xl p-3 shadow-md">
                                        <div className="text-2xl font-bold">{getWeekStats()}%</div>
                                        <div className="text-xs opacity-90">Woche</div>
                                    </div>
                                    <div className="flex-1 text-center bg-gradient-to-br from-blue-500 to-cyan-600 text-white rounded-xl p-3 shadow-md">
                                        <div className="text-2xl font-bold">{getSportStats()}/4</div>
                                        <div className="text-xs opacity-90">Sport</div>
                                    </div>
                                </div>
                            </div>

                            <div className="flex items-center justify-center gap-3 mt-4">
                                <button
                                    onClick={() => setCurrentWeek(currentWeek - 1)}
                                    className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700 font-medium transition text-sm"
                                >
                                    ← Zurück
                                </button>
                                <span className="text-gray-700 font-medium text-sm">
                                    {currentWeek === 0 ? 'Diese Woche' : `Woche ${currentWeek > 0 ? '+' : ''}${currentWeek}`}
                                </span>
                                <button
                                    onClick={() => setCurrentWeek(currentWeek + 1)}
                                    className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700 font-medium transition text-sm"
                                >
                                    Vor →
                                </button>
                            </div>
                        </div>

                        {/* Day Markers */}
                        <div className="bg-white rounded-2xl shadow-lg p-4 mb-4">
                            <h3 className="text-base font-semibold text-gray-800 mb-3">Wochenübersicht</h3>
                            <div className="grid grid-cols-7 gap-2">
                                {weekDates.map((date, i) => {
                                    const isWork = isWorkDay(date);
                                    const isTraining = isTrainingDay(date);
                                    const today = isToday(date);
                                    
                                    return (
                                        <div key={i} className="text-center">
                                            <div className={`text-sm font-semibold mb-1 ${today ? 'text-indigo-600' : 'text-gray-700'}`}>
                                                {weekDays[i]}
                                            </div>
                                            <div className={`text-xs mb-2 ${today ? 'text-indigo-500 font-bold' : 'text-gray-500'}`}>
                                                {formatDate(date)}
                                            </div>
                                            <button
                                                onClick={() => toggleWorkDay(date)}
                                                className={`w-full p-2 rounded-lg transition text-xs font-medium ${
                                                    isWork 
                                                        ? 'bg-red-500 text-white shadow-md' 
                                                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                                }`}
                                            >
                                                <div className="flex justify-center mb-1"><Briefcase /></div>
                                                {isWork ? 'Arbeit' : 'Frei'}
                                            </button>
                                            {isTraining && (
                                                <div className="mt-1 bg-orange-100 text-orange-700 text-xs p-1 rounded flex items-center justify-center gap-1">
                                                    <Users />
                                                    <span>Train</span>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Habit Grid */}
                        <div className="bg-white rounded-2xl shadow-lg p-4 mb-4 overflow-x-auto">
                            <div className="min-w-[600px]">
                                <table className="w-full">
                                    <thead>
                                        <tr>
                                            <th className="text-left pb-3 pr-3 font-semibold text-gray-700 text-sm">Gewohnheit</th>
                                            {weekDates.map((date, i) => (
                                                <th key={i} className="pb-3 px-1 text-center">
                                                    <div className={`font-semibold text-xs ${isToday(date) ? 'text-indigo-600' : 'text-gray-700'}`}>
                                                        {weekDays[i]}
                                                    </div>
                                                </th>
                                            ))}
                                            <th className="pb-3 pl-2"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {habits.map(habit => (
                                            <tr key={habit.id} className="border-t border-gray-100">
                                                <td className="py-2 pr-3">
                                                    <div className="flex items-center gap-2">
                                                        <div className={`w-2 h-2 rounded-full bg-${habit.color}-500`}></div>
                                                        <div>
                                                            <div className="font-medium text-gray-800 text-xs">{habit.name}</div>
                                                            <div className="text-xs text-gray-500">{habit.category}</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                {weekDates.map((date, i) => {
                                                    const dateKey = getDateKey(date);
                                                    const completed = habit.completed[dateKey];
                                                    return (
                                                        <td key={i} className="py-2 px-1 text-center">
                                                            <button
                                                                onClick={() => toggleHabit(habit.id, date)}
                                                                className={`transition ${isToday(date) ? 'ring-2 ring-indigo-300 rounded-full' : ''}`}
                                                            >
                                                                {completed ? (
                                                                    <div className={`text-${habit.color}-500`}><CheckCircle /></div>
                                                                ) : (
                                                                    <div className="text-gray-300"><Circle /></div>
                                                                )}
                                                            </button>
                                                        </td>
                                                    );
                                                })}
                                                <td className="py-2 pl-2">
                                                    <button
                                                        onClick={() => deleteHabit(habit.id)}
                                                        className="text-red-400 hover:text-red-600"
                                                    >
                                                        <Trash2 />
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Add Habit */}
                        <div className="bg-white rounded-2xl shadow-lg p-4 mb-4">
                            <h3 className="text-base font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                <Plus />
                                Neue Gewohnheit
                            </h3>
                            <div className="flex flex-col gap-2">
                                <input
                                    type="text"
                                    value={newHabit}
                                    onChange={(e) => setNewHabit(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && addHabit()}
                                    placeholder="z.B. Dehnen nach Training"
                                    className="px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                />
                                <div className="flex gap-2">
                                    <select
                                        value={selectedCategory}
                                        onChange={(e) => setSelectedCategory(e.target.value)}
                                        className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                    >
                                        {Object.keys(categories).map(cat => (
                                            <option key={cat} value={cat}>{cat}</option>
                                        ))}
                                    </select>
                                    <button
                                        onClick={addHabit}
                                        className="px-4 py-2 bg-indigo-500 text-white rounded-lg font-medium text-sm"
                                    >
                                        Hinzufügen
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Tips */}
                        <div className="bg-gradient-to-r from-indigo-100 to-purple-100 rounded-2xl p-4">
                            <h3 className="font-semibold text-gray-800 mb-2 flex items-center gap-2 text-sm">
                                <Clock />
                                Dein Wochenplan
                            </h3>
                            <ul className="space-y-1 text-gray-700 text-xs">
                                <li>💼 <strong>Arbeitstage:</strong> Schlafen bis 19:00 → Yoga abends</li>
                                <li>🥋 <strong>Di/Mi/Fr Training:</strong> Yoga nach dem Training</li>
                                <li>💪 <strong>Sport 60 Min:</strong> Ideal an freien Tagen (3-4x/Woche)</li>
                                <li>📅 <strong>Sonntag:</strong> Planung + Meal Prep</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<HabitTracker />, document.getElementById('app'));
    </script>
</body>
</html>